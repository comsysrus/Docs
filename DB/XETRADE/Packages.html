<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="keywords" content="TDM_Report">
        <link rel="stylesheet" type="text/css" media="screen" href="anim.css" title="report">
        <link rel="stylesheet" type="text/css" media="print" href="anim_NoFrames_print.css" title="report">
            <script src="tdmShowDetails.js" type="text/javascript"></script>
        <title>Toad Data Modeler - HTML Report</title>
    </head>

<body onLoad="getUrlItem()"><div class="mainContainer"><div id="headerContainer"><div id="header"><div class="title1"></div><div class="title2">Packages</div><div class="reportStats">13 января 2021 г. 22:28:33</div><div class="titleimage"><a href="https://www.quest.com/" target="_blank"><img src="Img/logo.png" alt="Made with Toad Data Modeler" border="0" /></a></div><div class="headerEnd"><p>&nbsp;</p></div></div><div id="navTop"><ul><li><a href="MInfo.html">Model Info</a></li><li><a href="MImage.html">ER Diagram</a></li><li><a href="Tables.html">Entities</a></li><li><a href="Columns.html">Attributes</a></li><li><a href="Indexes.html">Indexes</a></li><li><a href="Keys.html">Keys</a></li><li><a href="Procedures.html">Procedures</a></li><li><a href="Views.html">Views</a></li><li><a href="ViewRelations.html">View Relationships</a></li><li class="selLi"><a href="Packages.html" class="selAnchor">Packages</a></li><li><a href="Sequences.html">Sequences</a></li><li><a href="Editions.html">Editions</a></li></ul><div id="navTopEnd"><p>&nbsp;</p></div></div></div><div id="navCombo"><form name="allItems" action=""><select name="listOfItems" onChange="showSelected()"><option value="Pack_{66C64305-8CF5-4A28-A008-4B88787FB161}">XETRADE.CHAT_PACK</option><option value="Pack_{3F7BA645-F04F-421C-B760-DE90307DC78E}">XETRADE.DEV</option><option value="Pack_{FDC8AC30-5F8B-4D5C-8AC0-462EE307A00A}">XETRADE.MAIL</option><option value="Pack_{635989C1-2347-4832-9EEA-48A8414631D8}">XETRADE.MULTILOGIN_PACK</option><option value="Pack_{298BAA2E-E675-45F7-B562-83216BDF7EA8}">XETRADE.RESULT_PACK</option><option value="Pack_{2878ED9E-2E24-4114-BF6C-41C6A4CA2A85}">XETRADE.TRADE_PACK</option></select></form><div id="navComboEnd"><p></p></div></div><div id="navLeft"><div id="bookmark"><ul><li><a onClick="return showDetail('Pack_{66C64305-8CF5-4A28-A008-4B88787FB161}', this)">XETRADE.CHAT_PACK</a></li><li><a onClick="return showDetail('Pack_{3F7BA645-F04F-421C-B760-DE90307DC78E}', this)">XETRADE.DEV</a></li><li><a onClick="return showDetail('Pack_{FDC8AC30-5F8B-4D5C-8AC0-462EE307A00A}', this)">XETRADE.MAIL</a></li><li><a onClick="return showDetail('Pack_{635989C1-2347-4832-9EEA-48A8414631D8}', this)">XETRADE.MULTILOGIN_PACK</a></li><li><a onClick="return showDetail('Pack_{298BAA2E-E675-45F7-B562-83216BDF7EA8}', this)">XETRADE.RESULT_PACK</a></li><li><a onClick="return showDetail('Pack_{2878ED9E-2E24-4114-BF6C-41C6A4CA2A85}', this)">XETRADE.TRADE_PACK</a></li></ul><div id="bookmarkEnd"><p>&nbsp;</p></div></div></div><div class="separator" ></div><div class="container"><div id="content"><div id="Pack_{66C64305-8CF5-4A28-A008-4B88787FB161}" class="item">
<a name = "Pack_{66C64305-8CF5-4A28-A008-4B88787FB161}"></a>
<div class="caption1"><p>XETRADE.CHAT_PACK</p></div>
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
<tr>
<td class="tabhead" width="10%">Specification</td>
<td class="tabdata" width="90%"><pre><code>AS<br> /******************************************************************************<br>    NAME:       chat_pack<br>    PURPOSE:<br> <br>    REVISIONS:<br>    Ver        Date        Author           Description<br>    ---------  ----------  ---------------  ------------------------------------<br>    1.0        17.02.2009             1. Created this package.<br> ******************************************************************************/<br>    TYPE t_crs IS REF CURSOR;<br>    PROCEDURE MyProcedure(Param1 IN NUMBER);<br>    PROCEDURE getChat(begin_date IN DATE, end_date IN DATE, res OUT t_crs);<br>    PROCEDURE getLastMessageID(message_id OUT INTEGER);<br>    PROCEDURE getLastMessages(lastMessageID IN INTEGER, res OUT t_crs);<br>    PROCEDURE sendMessage(sender IN VARCHAR2, recipier IN varchar2, message IN VARCHAR2);  <br>   END;</code></pre></td>
</tr>
<tr>
<td class="tabhead" width="10%">Body Definition</td>
<td class="tabdata" width="90%"><pre><code>AS<br> <br> <br>   PROCEDURE MyProcedure(Param1 IN NUMBER) IS<br>    param2 INTEGER;<br>    BEGIN<br>     param2:=0;<br>    END;<br>   PROCEDURE getChat(begin_date IN DATE, end_date IN DATE, res OUT t_crs) IS<br>    BEGIN<br>     OPEN res FOR SELECT * FROM XETRADE.chat_table <br> 	 WHERE ttime&gt;=begin_date AND ttime&lt;=end_date;<br>    END; <br>   PROCEDURE getLastMessages(lastMessageID IN INTEGER, res OUT t_crs) IS<br>    BEGIN<br>     OPEN res FOR SELECT * FROM XETRADE.chat_table WHERE ID&gt;lastMessageID;<br>    END;  <br>   PROCEDURE getLastMessageID(message_id OUT INTEGER) IS<br>    BEGIN<br>     SELECT MAX(ID) INTO message_id FROM XETRADE.chat_table;  <br>    END;   <br>   PROCEDURE sendMessage(sender IN VARCHAR2, recipier IN VARCHAR2, message IN VARCHAR2) IS<br>   sender_id INTEGER;<br>    BEGIN<br>    SELECT ID INTO sender_id FROM XETRADE.system_users WHERE lower(username)=lower(sender);<br>     INSERT INTO XETRADE.chat_table (ID, sender_id, message, ttime, reciper_id)<br> 	 VALUES (XETRADE.main_seq.NEXTVAL, 1, message, SYSDATE, 1); <br> 	--parabolic<br>    END;  <br>   END;</code></pre></td>
</tr>
</table>
<br>
<div class="itemEnd"><p>&nbsp;</p></div></div>
<div id="Pack_{3F7BA645-F04F-421C-B760-DE90307DC78E}" class="item">
<a name = "Pack_{3F7BA645-F04F-421C-B760-DE90307DC78E}"></a>
<div class="caption1"><p>XETRADE.DEV</p></div>
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
<tr>
<td class="tabhead" width="10%">Specification</td>
<td class="tabdata" width="90%"><pre><code>AS<br>        procedure     getRoundByPseudoName(pseudo_name in varchar2, round out integer);       <br>       END Dev;</code></pre></td>
</tr>
<tr>
<td class="tabhead" width="10%">Body Definition</td>
<td class="tabdata" width="90%"><pre><code>AS<br> <br> PROCEDURE  getRoundByPseudoName(pseudo_name IN VARCHAR2, ROUND OUT INTEGER) IS<br>  BEGIN<br>   SELECT ps.round INTO getRoundByPseudoName.ROUND FROM ORABET.PSEUDO_SYSTEM ps<br>    WHERE ps.pseudo_name=getRoundByPseudoName.pseudo_name;<br>  END;  <br> END Dev;</code></pre></td>
</tr>
</table>
<br>
<div class="itemEnd"><p>&nbsp;</p></div></div>
<div id="Pack_{FDC8AC30-5F8B-4D5C-8AC0-462EE307A00A}" class="item">
<a name = "Pack_{FDC8AC30-5F8B-4D5C-8AC0-462EE307A00A}"></a>
<div class="caption1"><p>XETRADE.MAIL</p></div>
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
<tr>
<td class="tabhead" width="10%">Specification</td>
<td class="tabdata" width="90%"><pre><code>AS<br> <br>  PROCEDURE addMailingItem(account_id IN INTEGER,mailbox IN VARCHAR2,str_type IN VARCHAR2);<br>   PROCEDURE getMailingList(result OUT XETRADE.Result_Pack.t_crs);<br>   PROCEDURE mailMailingList;<br>   PROCEDURE signSMSMailing(username IN VARCHAR2, system_id IN INTEGER);<br>   PROCEDURE signMailMailing(username IN VARCHAR2, system_id IN INTEGER);<br>   PROCEDURE signAtradeMailing(username IN VARCHAR2, system_id IN INTEGER);<br>   PROCEDURE getMyMailMailing(username IN VARCHAR2, res OUT XETRADE.Result_Pack.t_crs);<br>   PROCEDURE getMySMSMailing(username IN VARCHAR2, res OUT XETRADE.Result_Pack.t_crs);<br>   PROCEDURE getMyAtradeMailing(username IN VARCHAR2, res OUT XETRADE.Result_Pack.t_crs);<br>   PROCEDURE getAllSMSMailingList(strategy_true_name IN VARCHAR2,res OUT XETRADE.Result_Pack.t_crs);<br>   PROCEDURE getAllAtradeMailingList(strategy_true_name IN VARCHAR2, res OUT XETRADE.Result_Pack.t_crs);<br>   procedure getAllMailMailingList(strategy_true_name in varchar2, res out XETRADE.result_pack.t_crs);<br>   PROCEDURE designMailing(mailing_id IN INTEGER);     <br> END Mail;</code></pre></td>
</tr>
<tr>
<td class="tabhead" width="10%">Body Definition</td>
<td class="tabdata" width="90%"><pre><code>AS <br>   PROCEDURE addMailingItem(account_id IN INTEGER,mailbox IN VARCHAR2,str_type IN VARCHAR2) IS<br>    BEGIN<br>     INSERT INTO XETRADE.MAILINGLIST(ID,account_id,mailbox,str_type) VALUES (XETRADE.main_seq.NEXTVAL,addMailingItem.account_id,<br> 	addMailingItem.mailbox,addMailingItem.str_type);<br>    END;<br>    <br>    <br>   PROCEDURE getMailingList(result OUT XETRADE.Result_Pack.t_crs) IS <br>    BEGIN<br>     OPEN result FOR SELECT ml.ID,cl.first_name||' '||cl.middle_name||' '||cl.last_name AS client_name, ml.mailbox,ml.str_type FROM XETRADE.MAILINGLIST ml,<br> 	XETRADE.CLIENTS cl WHERE cl.account_id=ml.account_id ORDER BY cl.first_name||' '||cl.middle_name||' '||cl.last_name;  <br>    END;<br>    <br>     <br>   PROCEDURE mailMailingList IS<br>    BEGIN<br>     FOR v IN (SELECT mailbox,str_type FROM XETRADE.MAILINGLIST) LOOP<br> 	 FOR x IN (SELECT ID,strategy_true_name,signal FROM ORABET.SYSTEM_SIGNAL2) LOOP<br> 	   XETRADE.Sendmail('birzha1x3@yandex.ru',v.mailbox,<br> 	   x.strategy_true_name||'. ????????? ?????????.',<br>     '??????: '||x.signal||'. ?? ????????: '|| '');<br> 	UPDATE ORABET.SYSTEM_SIGNAL2 SET is_sended=1 WHERE ID=x.ID;<br>  	END LOOP;<br>  	END LOOP;<br>    END; <br>   PROCEDURE signSMSMailing(username IN VARCHAR2, system_id IN INTEGER) IS<br>   UID INTEGER;<br>   mtid INTEGER;<br>   cnt INTEGER;<br>   section_id INTEGER;<br>    BEGIN<br>      SELECT ID INTO section_id FROM XETRADE.tradecentersections WHERE NAME='PUK';<br>      SELECT COUNT(*) INTO cnt   FROM XETRADE.sms_mailing_list ML,ORABET.PSEUDO_SYSTEM PS WHERE user_id=(SELECT ID FROM XETRADE.system_users WHERE username=signSMSMailing.username<br> 	 AND mess_type_id = (SELECT ID FROM XETRADE.mess_types WHERE mess_type='sms')) AND<br> 	 ML.system_id=PS.ID ORDER BY system_id;<br> 	 IF cnt&lt;30 THEN   <br>       SELECT ID INTO mtid FROM XETRADE.mess_types WHERE mess_type='sms';<br>       SELECT ID INTO UID FROM XETRADE.system_users WHERE username=signSMSMailing.username;<br> 	  INSERT INTO XETRADE.sms_mailing_list (ID,system_id,user_id,mess_type_id, section_id) VALUES (XETRADE.main_seq.NEXTVAL,system_id,UID,mtid, section_id );<br> 	 END IF; <br>    END;    <br>   PROCEDURE signMailMailing(username IN VARCHAR2, system_id IN INTEGER) IS<br>   UID INTEGER;<br>   mtid INTEGER;<br>   section_id INTEGER;<br>    BEGIN<br>       SELECT ID INTO section_id FROM XETRADE.tradecentersections WHERE NAME='PUK'; <br>       SELECT ID INTO mtid FROM XETRADE.mess_types WHERE mess_type='mail';<br>       SELECT ID INTO UID FROM XETRADE.system_users WHERE username=signMailMailing.username;<br> 	  INSERT INTO XETRADE.sms_mailing_list (ID,system_id,user_id,mess_type_id, section_id) VALUES (XETRADE.main_seq.NEXTVAL,system_id,UID,mtid,section_id );<br>    END;<br>    <br>   PROCEDURE designMailing(mailing_id IN INTEGER) IS<br>    BEGIN<br>     DELETE FROM XETRADE.sms_mailing_list WHERE ID=mailing_id;<br>    END;       <br>   PROCEDURE getMySMSMailing(username IN VARCHAR2, res OUT XETRADE.Result_Pack.t_crs) IS<br>    BEGIN<br>     OPEN res FOR SELECT ML.ID,PS.pseudo_name||'+'||PS.asset||'+'||PS.time_frame AS NAME   FROM XETRADE.sms_mailing_list ML,ORABET.PSEUDO_SYSTEM PS WHERE user_id=(SELECT ID FROM XETRADE.system_users WHERE LOWER(username)=LOWER(getMySMSMailing.username))<br> 	 AND mess_type_id = (SELECT ID FROM XETRADE.mess_types WHERE mess_type='sms') AND<br> 	 ML.system_id=PS.ID ORDER BY system_id;<br>    END;<br> --  PROCEDURE getAllSMSMailingList(res OUT dimo.Result_Pack.t_crs) IS<br> --   BEGIN<br> --    OPEN res FOR SELECT ML.ID,PS.pseudo_name||'+'||PS.asset||'+'||PS.time_frame AS NAME   FROM XETRADE.sms_mailing_list ML,dimo.PSEUDO_SYSTEM PS WHERE<br> --	 mess_type_id = (SELECT ID FROM XETRADE.mess_types WHERE mess_type='sms') AND<br> --	 ML.system_id=PS.ID ORDER BY system_id;    <br> --   END;   <br>   PROCEDURE getMyMailMailing(username IN VARCHAR2, res OUT XETRADE.Result_Pack.t_crs) IS<br>    BEGIN<br>     OPEN res FOR SELECT ML.ID,PS.pseudo_name||'+'||PS.asset||'+'||PS.time_frame AS NAME   FROM XETRADE.sms_mailing_list ML,orabet.PSEUDO_SYSTEM PS WHERE user_id=(SELECT ID FROM XETRADE.system_users WHERE LOWER(username)=LOWER(getMyMailMailing.username))<br> 	 AND mess_type_id = (SELECT ID FROM XETRADE.mess_types WHERE mess_type='mail') AND<br> 	 ML.system_id=PS.ID ORDER BY system_id;<br>    END; <br>   PROCEDURE getAllSMSMailingList(strategy_true_name IN VARCHAR2,res OUT XETRADE.Result_Pack.t_crs) IS<br>    BEGIN <br>     OPEN res FOR  SELECT NVL(su.phone,0) AS phone,ml.system_id, (SELECT NAME FROM XETRADE.tradecentersections WHERE ID=ml.section_id) AS NAME FROM XETRADE.sms_mailing_list ml,XETRADE.system_users su WHERE system_id=(SELECT ID FROM orabet.PSEUDO_SYSTEM WHERE true_name=strategy_true_name)<br> 		 AND ml.user_id=su.ID AND ml.mess_type_id=1;<br>    END;	 <br>   PROCEDURE getAllMailMailingList(strategy_true_name IN VARCHAR2,res OUT XETRADE.Result_Pack.t_crs) IS<br>    BEGIN <br>     OPEN res FOR  SELECT NVL(su.mailbox,0) AS mailbox,ml.system_id, (SELECT NAME FROM XETRADE.tradecentersections WHERE ID=ml.section_id) AS NAME FROM XETRADE.sms_mailing_list ml,XETRADE.system_users su WHERE system_id=(SELECT ID FROM orabet.PSEUDO_SYSTEM WHERE true_name=strategy_true_name)<br> 		 AND ml.user_id=su.ID AND ml.mess_type_id=2;<br>    END;	    <br>   PROCEDURE getAllAtradeMailingList(strategy_true_name IN VARCHAR2, res OUT XETRADE.Result_Pack.t_crs) IS<br>    BEGIN<br>     OPEN res FOR  SELECT NVL(su.atrade_acc,0) AS atrade_acc,ml.system_id, (SELECT NAME FROM XETRADE.tradecentersections WHERE ID=ml.section_id) AS NAME FROM XETRADE.sms_mailing_list ml,XETRADE.system_users su WHERE system_id=(SELECT ID FROM orabet.PSEUDO_SYSTEM WHERE true_name=strategy_true_name)<br> 		 AND ml.user_id=su.ID AND ml.mess_type_id=3;<br>    END; <br>    <br>   PROCEDURE signAtradeMailing(username IN VARCHAR2, system_id IN INTEGER) IS<br>   UID INTEGER;<br>   mtid INTEGER;<br>   section_id INTEGER;<br>    BEGIN<br>       SELECT ID INTO section_id FROM XETRADE.tradecentersections WHERE NAME='PUK';<br>       SELECT ID INTO mtid FROM XETRADE.mess_types WHERE mess_type='atrade';<br>       SELECT ID INTO UID FROM XETRADE.system_users WHERE username=signAtradeMailing.username;<br> 	  INSERT INTO XETRADE.sms_mailing_list (ID,system_id,user_id,mess_type_id, section_id) VALUES (XETRADE.main_seq.NEXTVAL,system_id,UID,mtid, section_id );<br>    END; <br>   PROCEDURE getMyAtradeMailing(username IN VARCHAR2, res OUT XETRADE.Result_Pack.t_crs) IS<br>   BEGIN<br>     OPEN res FOR SELECT ML.ID,PS.pseudo_name||'+'||PS.asset||'+'||PS.time_frame AS NAME   FROM XETRADE.sms_mailing_list ML,orabet.PSEUDO_SYSTEM PS WHERE user_id=(SELECT ID FROM XETRADE.system_users WHERE LOWER(username)=LOWER(getMyAtradeMailing.username))<br> 	 AND mess_type_id = (SELECT ID FROM XETRADE.mess_types WHERE mess_type='atrade') AND<br> 	 ML.system_id=PS.ID ORDER BY system_id;	   <br>   END; <br>          <br>   END Mail;</code></pre></td>
</tr>
</table>
<br>
<div class="itemEnd"><p>&nbsp;</p></div></div>
<div id="Pack_{635989C1-2347-4832-9EEA-48A8414631D8}" class="item">
<a name = "Pack_{635989C1-2347-4832-9EEA-48A8414631D8}"></a>
<div class="caption1"><p>XETRADE.MULTILOGIN_PACK</p></div>
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
<tr>
<td class="tabhead" width="10%">Specification</td>
<td class="tabdata" width="90%"><pre><code>AS<br>      PROCEDURE  connectProc(username IN VARCHAR2, session_id OUT INTEGER);<br>     PROCEDURE  disconnectProc(session_id IN INTEGER);<br>     PROCEDURE  checkSession(username IN VARCHAR2, session_id OUT INTEGER);<br> END multilogin_pack;</code></pre></td>
</tr>
<tr>
<td class="tabhead" width="10%">Body Definition</td>
<td class="tabdata" width="90%"><pre><code>AS   <br> PROCEDURE  connectProc(username IN VARCHAR2, session_id OUT INTEGER) IS<br> tmp_session_ID INTEGER;<br> user_id INTEGER;<br>  BEGIN<br>   SELECT ID INTO USER_id FROM XETRADE.system_users WHERE LOWER(username)=LOWER(connectProc.username); <br>   SELECT XETRADE.main_seq.NEXTVAL INTO tmp_session_ID FROM dual;<br>   INSERT INTO XETRADE.SESSION_TABLE (ID,user_id,begin_time) VALUES <br>    (tmp_session_id,user_id,SYSDATE);<br>   session_id:=tmp_session_id;   <br>  END; <br> PROCEDURE  disconnectProc(session_id IN INTEGER) IS<br>  BEGIN<br>   UPDATE XETRADE.SESSION_TABLE SET end_time=SYSDATE WHERE ID=session_id;<br>  END; <br> PROCEDURE checkSession(username IN VARCHAR2,session_id OUT INTEGER) IS<br>  BEGIN<br>   SELECT MAX(ID) INTO session_id FROM XETRADE.SESSION_TABLE WHERE user_id=(SELECT ID FROM XETRADE.system_users WHERE LOWER(username)=LOWER(checkSession.username));<br>  END; <br>  END multilogin_pack;</code></pre></td>
</tr>
</table>
<br>
<div class="itemEnd"><p>&nbsp;</p></div></div>
<div id="Pack_{298BAA2E-E675-45F7-B562-83216BDF7EA8}" class="item">
<a name = "Pack_{298BAA2E-E675-45F7-B562-83216BDF7EA8}"></a>
<div class="caption1"><p>XETRADE.RESULT_PACK</p></div>
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
<tr>
<td class="tabhead" width="10%">Specification</td>
<td class="tabdata" width="90%"><pre><code>AS<br> type t_crs is ref cursor;<br>   PROCEDURE getEmitent(partialName in varchar2, result out XETRADE.result_pack.t_crs);<br>   Procedure getReleaseTail(release_id in integer, result out XETRADE.result_pack.t_crs);<br> <br> END result_pack;</code></pre></td>
</tr>
<tr>
<td class="tabhead" width="10%">Body Definition</td>
<td class="tabdata" width="90%"><pre><code>AS<br> <br> PROCEDURE getEmitent(partialName in varchar2,result out XETRADE.result_pack.t_crs) is <br>  begin<br>   null;--open result for select * from dimo.kcb_view where lower (ansi_name) like '%'||lower(partialName)||'%';<br>  end;<br> Procedure getReleaseTail(release_id in integer, result out XETRADE.result_pack.t_crs) is<br>  begin<br>   null;--open result for select * from dimo.releases_tail where release_id=getReleaseTail.release_id order by value_id;<br>  end; <br> <br> END result_pack;</code></pre></td>
</tr>
</table>
<br>
<div class="itemEnd"><p>&nbsp;</p></div></div>
<div id="Pack_{2878ED9E-2E24-4114-BF6C-41C6A4CA2A85}" class="item">
<a name = "Pack_{2878ED9E-2E24-4114-BF6C-41C6A4CA2A85}"></a>
<div class="caption1"><p>XETRADE.TRADE_PACK</p></div>
<table class="tabformat" border="0" cellpadding="2" cellspacing="1" width="100%">
<tr>
<td class="tabhead" width="10%">Specification</td>
<td class="tabdata" width="90%"><pre><code>AS<br> <br> TYPE t_crs IS REF CURSOR;<br> <br>     PROCEDURE  getFixedLotsBySystem(strategy_pseudo_name IN VARCHAR2, user_id in integer, fixed_lots OUT integer);<br>     procedure  addStopSignal(strategy_true_name IN VARCHAR2, signal_date IN DATE, signal_price IN NUMBER, signal IN VARCHAR2);<br>     PROCEDURE  addTradeSignalModelling(strategy_true_name IN VARCHAR2, signal_date IN DATE, signal_price IN NUMBER, signal IN VARCHAR2);    <br>     PROCEDURE  getPseudoStrategies(username IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  getPortfolio(username IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  Getsignalsbystrategyname(strategy_pseudo_name IN VARCHAR2, begin_date IN DATE, end_date IN DATE, res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  Getsignalsbystrategyname3(strategy_pseudo_name IN VARCHAR2, begin_date IN DATE, end_date IN DATE, res OUT XETRADE.TRADE_PACK.t_crs);    <br>     PROCEDURE  Getsignalsbystrategyname_S(strategy_pseudo_name IN VARCHAR2, begin_date IN DATE, end_date IN DATE, res OUT XETRADE.TRADE_PACK.t_crs);    <br>     PROCEDURE  getLastSignal(strategy_pseudo_name IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  addUser(username IN VARCHAR2);<br>     PROCEDURE  delUser(user_id IN NUMBER);<br>     PROCEDURE  getUsers(res OUT XETRADE.TRADE_PACK.t_crs); <br>     PROCEDURE  addUserStrategyLink(strategy_id IN NUMBER, user_id IN NUMBER);<br>     PROCEDURE  getSystemRules(res OUT XETRADE.TRADE_PACK.t_crs);  <br>     PROCEDURE  getRealStrategies(res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  delUserStrategyLink(link_id IN INTEGER);<br>     PROCEDURE  createUser(username IN VARCHAR2, userpass IN VARCHAR2);<br>     PROCEDURE  connectProc(username IN VARCHAR2, session_id OUT INTEGER);<br>     PROCEDURE  disconnectProc(session_id IN INTEGER);<br>     PROCEDURE  checkSession(username IN VARCHAR2, session_id OUT INTEGER);<br>     PROCEDURE  getLastTrueSignal(strategy_name IN VARCHAR2, signal OUT VARCHAR2);<br>     PROCEDURE  changeP(username IN VARCHAR2, newP IN VARCHAR2);<br>     PROCEDURE  addStrategySectionLink(strategy_id IN INTEGER, section_id IN INTEGER);<br>     PROCEDURE  delStrategySectionLink(link_id IN INTEGER);<br>     PROCEDURE  getStrategySectionList(res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  getSectionsList(res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  getSectionIdByStrategyTrueName(strategy_true_name IN VARCHAR2, section_id OUT INTEGER, ticker OUT VARCHAR2);<br>     PROCEDURE  addIssuer(paper_no IN VARCHAR2,issuer IN VARCHAR2, ticker IN VARCHAR2);<br>     PROCEDURE  getIssuerByPaperNo(paper_no IN VARCHAR2, issuer OUT VARCHAR2, ticker OUT VARCHAR2);<br>     PROCEDURE  getTickerByPseudoName(pseudo_name IN VARCHAR2, ticker OUT VARCHAR2);<br>     PROCEDURE  getPseudoName(NAME IN VARCHAR2, pseudo_name OUT VARCHAR2);<br>     PROCEDURE  getLastSystemSignals(res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  clearSignals(strategy_name IN VARCHAR2);<br>     PROCEDURE  addSU_ACClink(username IN VARCHAR2, acc IN VARCHAR2, cap_part IN NUMBER, system_true_name IN VARCHAR2);<br>     PROCEDURE  getCapParts(username IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  getCapPartBySystem(strategy_pseudo_name IN VARCHAR2, user_id in integer, cap_part OUT NUMBER);<br> 	PROCEDURE  getNumContrBySystem(strategy_pseudo_name IN VARCHAR2, user_id in integer, num_contr OUT integer);   	<br> 	<br>     procedure  getSlippageBySystem(strategy_pseudo_name in varchar2, user_id in integer, slippage out number);<br>     procedure  addSlippage(port_id in integer, system_pseudo_name in varchar2, slippage in number);	<br>     PROCEDURE  Getclasscodebyticker(ticker IN VARCHAR2, class_code OUT VARCHAR2);<br>     PROCEDURE  getLotsBySystem(strategy_pseudo_name IN VARCHAR2, lots OUT NUMBER);<br>     PROCEDURE  getKByTicker(ticker IN VARCHAR2, k OUT NUMBER);<br>     PROCEDURE  addNewTicker(NAME IN VARCHAR2, long_name IN VARCHAR2, alfa_name IN VARCHAR2, alfa_long_name IN VARCHAR2, alfa_paper_no IN VARCHAR2, lots IN INTEGER, decimals IN INTEGER);<br>     PROCEDURE  getBCSSignal(res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  getBCSSystemSignal(res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  addNewPort(owner IN VARCHAR2, NAME IN VARCHAR2);<br>     PROCEDURE  checkPort(owner IN VARCHAR2, NAME IN VARCHAR2, is_exist OUT INTEGER);<br>     PROCEDURE  getMyPortHead(owner IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs);    <br>     PROCEDURE  addPortTail(port_id IN INTEGER, system_pseudo_name IN VARCHAR2, cap_part IN NUMBER);<br>     PROCEDURE  addPortTailFixedLots(port_id IN INTEGER, system_pseudo_name IN VARCHAR2, fixed_lots IN NUMBER);<br> 	procedure  addPortTailFut(port_id in integer, system_pseudo_name in varchar2, num_contr in number);<br>     PROCEDURE  getPortTail(port_id IN INTEGER, res OUT XETRADE.TRADE_PACK.t_crs);<br>     PROCEDURE  checkSumByPort(port_id IN INTEGER, summ OUT NUMBER);<br>     PROCEDURE  dropPort(port_id IN INTEGER);<br>     PROCEDURE  dropPortTail(tail_id IN INTEGER);<br>     PROcedure   addMyAutoPort(user_id in integer,port_id in integer);<br>     procedure   delMyAutoPort(user_id in integer, port_id in integer);<br>     procedure    getMyAutoPort(user_id in integer, res out XETRADE.TRADE_PACK.t_crs);<br>     procedure    getUserIdByUserName(username in varchar2, userid out integer);<br>     procedure    checkVersion(current_version in number,is_valid out integer);<br>     procedure    getPercIncrement(ticker in varchar2, increment out number);<br>     procedure    addBreakDownLevel(strategy_name in varchar2, price in number, ismaximum in integer, ttime in date);<br>     procedure    updateBreakDownLevels(strategy_name in varchar2, price in number, ttime in date);<br>     PROCEDURE  addProfitCash(profit_str IN VARCHAR2);<br>     PROCEDURE  addProfitHist(strategy_id IN INTEGER, profit_value IN NUMBER);    <br>     PROCEDURE  getStrategyIdByPseudoName(pseudo_name IN VARCHAR2, strategy_id OUT INTEGER);<br>     procedure  getPriceByPseudoNameAndDate(pseudo_name in varchar2, datum in date, price out number); <br>     procedure  getProfitXMLToSend(res out XETRADE.TRADE_PACK.t_crs);<br>     procedure  updateProfitCashLastRes(id in integer, last_res in varchar2);<br>     procedure  updateProfitCashSended(id in integer);          <br>     procedure  getPaperNoByTicker(ticker in varchar2, paper_no out varchar2);  <br>     procedure  getPaperNoByStrategyName(strategy_name in varchar2, paper_no out varchar2);<br>     procedure  getPaperNoByStrategyId(strategy_id in integer, paper_no out varchar2); <br>     procedure addAbstractSignal(strategy_true_name in varchar2, signal_date in date, signal_price in number,signal in varchar2);   <br>     procedure setStrategyStop(strategy_true_name in varchar2, stop_level in number, stop_type in varchar2);<br>     procedure checkStrategyStopDown(strategy_true_name in varchar2, current_price in number, is_worked out integer);<br>     procedure checkStrategyStopUp(strategy_true_name in varchar2, current_price in number, is_worked out integer);<br>     procedure clearStopsUp(strategy_true_name in varchar2);<br>     procedure clearStopsDown(strategy_true_name in varchar2);<br> 	procedure checkIsAutoPortActiv(username in varchar2, is_activ out integer);<br>     procedure getSystemComisses(res out XETRADE.TRADE_PACK.t_crs);<br>     procedure addSystemComiss(strategy_true_name in varchar2, comiss_value in number, start_date in date);<br>     procedure deleteSystemComiss(id in integer);<br>     procedure checkSystemComissByDate(strategy_true_name in varchar2, curr_date in date, comiss out number);<br> 	procedure checkIsFirstTime(username in varchar2, isFirstTime out integer);<br> 	procedure checkIsFutByPseudoName(pseudo_name in varchar2, is_fut out integer);<br>     procedure getOCRecepients(res out XETRADE.TRADE_PACK.t_crs);<br>     procedure addOCRecepient(user_id in integer);<br>     procedure delOCRecepient(user_id in integer);	<br>     procedure checkOCRUsername(username in varchar2);	<br>     procedure importTradesHistory(strategy_true_name in varchar2, signal_date in date, signal_price in number, signal in varchar2);<br>     procedure getStrategyTrueNameById(strategy_id in integer, strategy_true_name out varchar2);<br>     procedure addBotSignal(entry_date in varchar2, exch_long in varchar2, exch_short in varchar2, asset in varchar2, fees in varchar2, price_long in number, price_short in number, eff_spread in number, bas_spread in number, real_profit in number,signal_id in integer);<br>     procedure addRepeater(repeat in varchar2);<br>     procedure getRepeater(id in integer, res out XETRADE.TRADE_PACK.t_crs);<br>     procedure isNeedToSendCutOff(is_need out integer);<br>     procedure getCutOffs(res out XETRADE.TRADE_PACK.t_crs);<br>     procedure getLastItpAction(client_code out varchar2, ticker out varchar2, direction out varchar2, id out integer);<br>     procedure lock_itp(vm_addr in varchar2, result out integer);<br>     procedure unlock_itp(vm_addr in varchar2, result out integer);<br>     procedure getServerTime(server_time out date);<br>     procedure addItpLog(sender in varchar2, action in varchar2);<br>     procedure getPriceLevels(ticker in varchar2, bid out number, offer out number);<br>     procedure getAlerts(res out XETRADE.TRADE_PACK.t_crs);<br>     procedure addY2Yrecord(client_code in varchar2, bal_start in number, comiss in number, frcb in number, bal_end in number, rep_date in date);<br>     procedure getQuikQuotes(res out XETRADE.TRADE_PACK.t_crs);<br>     procedure getLotsCounter(res out XETRADE.TRADE_PACK.t_crs);<br>     procedure doTrade(client_code in varchar2, ticker in varchar2, operation in varchar2,  lots in varchar2, v_mess out varchar2);<br> END Trade_Pack;</code></pre></td>
</tr>
<tr>
<td class="tabhead" width="10%">Body Definition</td>
<td class="tabdata" width="90%"><pre><code>AS<br> <br> <br>  <br>  <br> procedure     addStopSignal(strategy_true_name IN VARCHAR2, signal_date IN DATE, signal_price IN NUMBER, signal IN VARCHAR2) is<br> sg VARCHAR2(10);<br> is_resolved integer;<br> rnd integer;<br> hr integer;<br> mint integer;<br> my_price number;<br>  begin<br>   SELECT EXTRACT (HOUR FROM SYSTIMESTAMP)+4, EXTRACT (MINUTE FROM SYSTIMESTAMP) into hr, mint from dual;<br>   my_price:=signal_price;<br>  if ((hr&gt;=18) and (mint&gt;=15) ) then return;<br>  end if;<br>  if ((hr&gt;=18) and (mint&gt;=15) ) then return;<br>  end if;  <br>  select signal_resolved into is_resolved from orabet.pseudo_system where true_name=strategy_true_name;<br>  if is_resolved=0 then return; end if;<br>  select value into is_resolved from ORABET.signal_is_resolved;<br>  select round into rnd from orabet.pseudo_system where true_name=strategy_true_name;<br> -- insert into bcs.log (id,value) values (XETRADE.main_seq.nextval, 'is_resolved is '||is_resolved||' '||sysdate);<br>  commit;<br>  if is_resolved=1 then<br>  --INSERT INTO ORABET.system_signal2_par (ID,strategy_true_name,signal_date,signal_price,signal)<br>  --VALUES (XETRADE.main_seq.NEXTVAL,strategy_true_name,signal_date,signal_price,signal);<br>  SELECT signal INTO sg FROM ORABET.system_signal2 WHERE ID = (SELECT MAX(ID) FROM ORABET.system_signal2 WHERE strategy_true_name=addStopSignal.strategy_true_name);<br>  IF (LOWER(sg)&lt;&gt;LOWER(signal)) AND (LOWER(signal)&lt;&gt;'hold') AND (TRUNC(signal_date,'dd')=TRUNC(SYSDATE,'dd')) THEN<br>   INSERT INTO ORABET.system_signal2 (ID, strategy_true_name, signal_date, signal_price, signal,fact_date, is_stop_active)<br>    VALUES (XETRADE.main_seq.NEXTVAL, strategy_true_name, signal_date, round(my_price,-rnd), signal, TO_CHAR(SYSDATE, 'yyyymmdd hh24:mi:ss'),0);<br>    end if;<br>    end if;<br>  end; <br> PROCEDURE  addTradeSignalModelling(strategy_true_name IN VARCHAR2, signal_date IN DATE, signal_price IN NUMBER, signal IN VARCHAR2) IS<br> sg VARCHAR2(10);<br> is_resolved integer;<br>  BEGIN<br>  select value into is_resolved from ORABET.signal_is_resolved;<br> -- insert into bcs.log (id,value) values (XETRADE.main_seq.nextval, 'is_resolved is '||is_resolved||' '||sysdate);<br>  commit;<br>  if is_resolved=1 then<br>  INSERT INTO ORABET.system_signal2_par (ID,strategy_true_name,signal_date,signal_price,signal)<br>  VALUES (XETRADE.main_seq.NEXTVAL,strategy_true_name,signal_date,signal_price,signal);<br>  SELECT signal INTO sg FROM ORABET.system_signal2 WHERE ID = (SELECT MAX(ID) FROM ORABET.system_signal2 WHERE strategy_true_name=addTradeSignalModelling.strategy_true_name);<br>  IF (LOWER(sg)&lt;&gt;LOWER(signal)) AND (LOWER(signal)&lt;&gt;'hold') THEN<br>   INSERT INTO ORABET.system_signal2 (ID, strategy_true_name, signal_date, signal_price, signal,fact_date)<br>    VALUES (XETRADE.main_seq.NEXTVAL, strategy_true_name, signal_date, signal_price, signal, TO_CHAR(SYSDATE, 'yyyymmdd hh24:mi:ss'));<br>  UPDATE ORABET.last_signal SET last_signal=signal, last_signal_date=signal_date<br>  WHERE true_name = strategy_true_name;<br>  END IF;<br>  IF SQL%NOTFOUND THEN<br>   INSERT INTO ORABET.last_signal (ID, true_name, last_signal, last_signal_date)<br>   VALUES (XETRADE.main_seq.NEXTVAL, strategy_true_name, signal, signal_date);   <br>   END IF;<br> end if;<br>  END; <br>  <br>  <br> PROCEDURE  getPseudoStrategies(username IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN<br>   IF (LOWER(username)&lt;&gt;'dimo') THEN <br>   OPEN res FOR <br>   SELECT ID, pseudo_name||'+'||asset||'+'||time_frame AS NAME,true_name <br>   FROM orabet.pseudo_system <br>   WHERE ID IN (SELECT strategy_true_id <br>                FROM XETRADE.system_rules <br>                WHERE user_id= (SELECT ID <br>                                FROM XETRADE.system_users <br>                                WHERE LOWER(username)=LOWER(getPseudoStrategies.username))) <br>   ORDER BY ID;<br>  ELSE<br>   OPEN res FOR <br>   SELECT ID, pseudo_name||'+'||asset||'+'||time_frame AS NAME, true_name <br>   FROM orabet.pseudo_system  <br>   ORDER BY ID;<br>  END IF;<br>  END; <br>  <br>  <br> PROCEDURE  getPortfolio(username IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN<br>  IF (LOWER(username)&lt;&gt;'kirkov' AND LOWER(username)&lt;&gt;'dimo') THEN <br>   OPEN res FOR SELECT ID, pseudo_name||'+'||asset||'+'||time_frame AS NAME FROM orabet.pseudo_system WHERE ID IN <br>   (SELECT strategy_true_id FROM XETRADE.system_rules WHERE user_id=(SELECT ID FROM XETRADE.system_users WHERE <br>   LOWER(username)=(getPortfolio.username))) ORDER BY ID;<br>  ELSE<br>   OPEN res FOR SELECT ID, pseudo_name||'+'||asset||'+'||time_frame AS NAME FROM orabet.pseudo_system  ORDER BY ID;<br>  END IF;  <br>  END; <br> PROCEDURE Getsignalsbystrategyname(strategy_pseudo_name IN VARCHAR2, begin_date IN DATE, end_date IN DATE, res OUT XETRADE.TRADE_PACK.t_crs) IS<br> tf VARCHAR2(10);<br> pn VARCHAR2(10);<br>  BEGIN<br>   SELECT paper_no INTO pn FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name; <br>   SELECT time_frame INTO tf FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name;<br>   IF ((TO_NUMBER(pn)&gt;0) or (TO_NUMBER(pn)&lt;-149))  <br>   THEN<br>     IF tf='min60' <br>     THEN OPEN res FOR SELECT /*+RULE*/ b.time as ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') AS signal <br>     FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>                                                                         WHERE pseudo_name=strategy_pseudo_name)) a,<br>                                         (SELECT * FROM orabet.arch_min60 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>                                         WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date ORDER BY b.time ASC;<br>   ELSIF tf='min15' <br>   THEN <br>      OPEN res FOR SELECT /*+RULE*/ b.time as ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') AS signal <br>                     FROM (<br>                           SELECT * <br>                           FROM ORABET.system_signal2 <br>                           WHERE strategy_true_name=(<br>                                                     SELECT true_name <br>                                                     FROM orabet.pseudo_system<br>                                                     WHERE pseudo_name=strategy_pseudo_name<br>                                                     )<br>                           ) a, <br>                           (<br>                            SELECT * <br>                            FROM orabet.arch_min15 <br>                            WHERE paper_no=(<br>                                             SELECT paper_no <br>                                             FROM orabet.pseudo_system <br>                                             WHERE pseudo_name=strategy_pseudo_name<br>                                            )<br>                           ) b  <br>                      WHERE <br>                            a.signal_date(+)=b.time AND <br>                            b.time&gt;=begin_date AND <br>                            b.time&lt;end_date  <br>                      ORDER BY b.time ASC;  <br>   <br>   OPEN res FOR <br>       SELECT /*+RULE*/ b.time as ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') AS signal <br>       FROM (<br>             SELECT * <br>             FROM ORABET.system_signal2 <br>             WHERE strategy_true_name=(<br>                                       SELECT true_name <br>                                       FROM orabet.pseudo_system<br>                                       WHERE pseudo_name=strategy_pseudo_name)<br>             ) a,<br>             (<br>              SELECT * <br>              FROM orabet.arch_min15 <br>              WHERE paper_no=(<br>                                   SELECT paper_no <br>                                   FROM orabet.pseudo_system <br>                                   WHERE pseudo_name=strategy_pseudo_name)<br>              ) b  <br>      WHERE <br>            a.signal_date(+)=b.time AND <br>            b.time&gt;=begin_date AND <br>            b.time&lt;end_date  <br>      ORDER BY b.time ASC;<br>   <br>   ELSIF tf='min5' THEN<br>   OPEN res FOR SELECT /*+RULE*/ b.time as ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name)) a,<br>   (SELECT * FROM orabet.arch_min5 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date  ORDER BY b.time ASC;  OPEN res FOR SELECT /*+RULE*/ b.time as ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name)) a,<br>   (SELECT * FROM orabet.arch_min5 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date  ORDER BY b.time ASC;     <br>   END IF;  <br>   <br>   ELSE <br>   IF tf='min60' THEN <br>   OPEN res FOR SELECT /*+RULE*/ b.time as ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name) and signal_date&gt;=begin_date and signal_date&lt;end_date) a,<br>   (SELECT * FROM orabet.arch_min60 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date ORDER BY b.time ASC;<br>   ELSIF tf='min15' <br>   <br>   THEN<br>   OPEN res FOR SELECT /*+RULE*/ b.time, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   AS signal <br>   FROM (<br>          SELECT * <br>          FROM ORABET.system_signal2 <br>          WHERE strategy_true_name=(<br>                                     SELECT true_name <br>                                     FROM orabet.pseudo_system <br>                                     WHERE pseudo_name=strategy_pseudo_name<br>                                     ) <br>                                     and signal_date&gt;=begin_date and signal_date&lt;end_date) a,<br>  (SELECT * FROM ORABET.arch_min15_2 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date  ORDER BY b.time ASC;<br>   END IF;<br>       <br>   END IF;<br>   <br>  END; <br> /*tf VARCHAR2(10);<br>  BEGIN<br>   SELECT time_frame INTO tf FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name;<br>   IF tf='min60' THEN <br>   OPEN res FOR SELECT /*+RULE*/ /*b.ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   /*AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name)) a,<br>   (SELECT * FROM orabet.arch_min60 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.ttime AND b.ttime&gt;=begin_date AND b.ttime&lt;end_date ORDER BY b.ttime ASC;<br>   ELSIF tf='min15' THEN<br>   OPEN res FOR SELECT /*+RULE*/ /*b.ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   /*AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name)) a,<br>   (SELECT * FROM orabet.arch_min15 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.ttime AND b.ttime&gt;=begin_date AND b.ttime&lt;end_date  ORDER BY b.ttime ASC;<br>   END IF;  <br>  END; */<br> PROCEDURE Getsignalsbystrategyname3(strategy_pseudo_name IN VARCHAR2, begin_date IN DATE, end_date IN DATE, res OUT XETRADE.TRADE_PACK.t_crs) IS<br> tf VARCHAR2(10);<br> pn varchar2(10);<br>  BEGIN<br>   select paper_no into pn from orabet.pseudo_system where pseudo_name=strategy_pseudo_name;<br>   if (to_number(pn)&gt;0) or (to_number(pn)&lt;-152) then<br>   OPEN res FOR SELECT /*+RULE*/ b.time as ttime, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name)) a,<br>   (SELECT * FROM orabet.arch_min15 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date  ORDER BY b.time ASC;<br>   else<br>   OPEN res FOR SELECT /*+RULE*/ b.time, b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name)) a,<br>   (SELECT * FROM ORABET.arch_min15_2 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date  ORDER BY b.time ASC;  <br>   end if;<br>   <br>  END;  <br> PROCEDURE Getsignalsbystrategyname_S(strategy_pseudo_name IN VARCHAR2, begin_date IN DATE, end_date IN DATE, res OUT XETRADE.TRADE_PACK.t_crs) IS<br> tf VARCHAR2(10);<br>  BEGIN<br>   SELECT time_frame INTO tf FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name;<br>   IF tf='min60' THEN <br>   OPEN res FOR SELECT /*+RULE*/ b.time as ttime, b.OPEN, b.HIGH, b.LOW,b.CLOSE, NVL(a.signal_date,SYSDATE) AS signal_date, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold') <br>   AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name)) a,<br>   (SELECT * FROM orabet.arch_min60 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date ORDER BY b.time ASC;<br>   ELSIF tf='min15' THEN<br>   OPEN res FOR SELECT /*+RULE*/ TO_CHAR(b.time,'dd.mm hh24:mi') AS ttime, b.OPEN, b.HIGH, b.LOW,b.CLOSE, TO_CHAR(NVL(a.signal_date,SYSDATE),'dd.mm hh24:mi') AS signal_date, ROUND(NVL(a.signal_price,-1),3) AS signal_price, LOWER(NVL(a.signal,'hold')) <br>   AS signal FROM (SELECT * FROM ORABET.system_signal2 WHERE strategy_true_name=(SELECT true_name FROM orabet.pseudo_system<br>   WHERE pseudo_name=strategy_pseudo_name)) a,<br>   (SELECT * FROM orabet.arch_min15 WHERE paper_no=(SELECT paper_no FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name)) b  <br>   WHERE a.signal_date(+)=b.time AND b.time&gt;=begin_date AND b.time&lt;end_date  ORDER BY b.time ASC;<br>   END IF;  <br>  END; <br> PROCEDURE  getLastSignal(strategy_pseudo_name IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN<br>   OPEN res FOR <br>   SELECT * <br>   FROM ORABET.system_signal2 <br>   WHERE signal_date=<br>   (<br>          SELECT MAX(signal_date) <br>          FROM ORABET.system_signal2 <br>          WHERE strategy_true_NAME=(<br>                SELECT true_name <br>                FROM orabet.pseudo_system <br>                WHERE pseudo_name=strategy_pseudo_name )<br>   )<br>   AND strategy_true_NAME=(SELECT true_name FROM orabet.pseudo_system WHERE pseudo_name=strategy_pseudo_name );<br> END;<br>  <br> PROCEDURE addUser(username IN VARCHAR2) IS<br> u_id integer;<br>  BEGIN<br>   INSERT INTO XETRADE.system_users(ID,username)<br>    VALUES (XETRADE.main_seq.NEXTVAL,username) returning id into u_id;<br>   begin<br>   	  for v in (select system_id from XETRADE.system_packets_tail where packet_id=32784673) loop<br>  	  XETRADE.trade_pack.addUserStrategyLink(v.system_id, u_id);<br>   end loop;<br> end; <br>  END; <br> PROCEDURE  delUser(user_id IN NUMBER) IS<br>  BEGIN<br>   DELETE FROM XETRADE.system_users WHERE ID=user_id;<br>  END; <br> PROCEDURE getUsers(res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN<br>   OPEN res FOR SELECT * FROM XETRADE.system_users WHERE LOWER(username)&lt;&gt;'kirkov'<br>   AND LOWER(username)&lt;&gt;'dimo' ORDER BY username ASC;<br>  END; <br> PROCEDURE  addUserStrategyLink(strategy_id IN NUMBER, user_id IN NUMBER) IS<br>  BEGIN<br>   INSERT INTO XETRADE.system_rules(ID,strategy_true_id,user_id)<br>    VALUES (XETRADE.main_seq.NEXTVAL, strategy_id, user_id);<br>  END;<br> PROCEDURE  getRealStrategies(res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN<br>   OPEN res FOR SELECT * FROM orabet.pseudo_system ORDER BY ID;<br>  END; <br> PROCEDURE  delUserStrategyLink(link_id IN INTEGER) IS<br>  BEGIN<br>   DELETE FROM XETRADE.system_rules WHERE ID=link_id;<br>  END; <br> PROCEDURE  getSystemRules(res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN <br>   OPEN res FOR  SELECT c.ID,a.true_name, b.username FROM orabet.pseudo_system a, XETRADE.system_users b, <br>   XETRADE.system_rules c WHERE c.STRATEGY_TRUE_ID=a.ID AND c.USER_ID=b.ID ORDER BY LOWER(b.username);<br>  END; <br> PROCEDURE  createUser(username IN VARCHAR2, userpass IN VARCHAR2) IS<br>  BEGIN<br>   EXECUTE IMMEDIATE 'create user '||username||' identified by '||userpass; <br>   COMMIT;<br>   EXECUTE IMMEDIATE 'grant connect to '||username;<br>   COMMIT;<br>   EXECUTE IMMEDIATE 'grant create session to '||username;<br>   COMMIT;<br>   EXECUTE IMMEDIATE 'GRANT EXECUTE ON XETRADE.Getsystems TO '||username;<br>   COMMIT;<br>   EXECUTE IMMEDIATE 'GRANT EXECUTE ON XETRADE.Trade_Pack TO '||username;<br>   COMMIT;<br>   EXECUTE IMMEDIATE 'GRANT EXECUTE ON XETRADE.Getsignalsbystrategyname TO '||username;<br>   COMMIT; <br>   EXECUTE IMMEDIATE 'GRANT EXECUTE ON XETRADE.mail TO '||username;<br>   COMMIT;   <br>   EXECUTE IMMEDIATE 'GRANT EXECUTE ON XETRADE.multilogin_pack TO '||username;<br>   COMMIT; <br>   EXECUTE IMMEDIATE 'GRANT EXECUTE ON XETRADE.dev TO '||username;<br>   COMMIT;  <br>   EXECUTE IMMEDIATE 'GRANT EXECUTE ON XETRADE.getOrderId TO '||username;<br>   COMMIT;<br>   execute immediate 'grant execute on XETRADE.chat_pack to '||username;    <br>  END; <br> PROCEDURE  connectProc(username IN VARCHAR2, session_id OUT INTEGER) IS<br> tmp_session_ID INTEGER;<br> user_id INTEGER;<br>  BEGIN<br>   SELECT ID INTO USER_id FROM XETRADE.system_users WHERE LOWER(username)=LOWER(connectProc.username); <br>   SELECT XETRADE.main_seq.NEXTVAL INTO tmp_session_ID FROM dual;<br>   INSERT INTO XETRADE.SESSION_TABLE (ID,user_id,begin_time) VALUES <br>    (tmp_session_id,user_id,SYSDATE);<br>   session_id:=tmp_session_id;   <br>  END; <br> PROCEDURE  disconnectProc(session_id IN INTEGER) IS<br>  BEGIN<br>   UPDATE XETRADE.SESSION_TABLE SET end_time=SYSDATE WHERE ID=session_id;<br>  END; <br> PROCEDURE checkSession(username IN VARCHAR2,session_id OUT INTEGER) IS<br>  BEGIN<br>   SELECT MAX(ID) INTO session_id FROM XETRADE.SESSION_TABLE WHERE user_id=(SELECT ID FROM XETRADE.system_users WHERE LOWER(username)=LOWER(checkSession.username));<br>  END; <br> PROCEDURE  getLastTrueSignal(strategy_name IN VARCHAR2, signal OUT VARCHAR2) IS<br>  BEGIN<br>   SELECT signal INTO signal FROM ORABET.system_signal2 WHERE ID = (SELECT MAX(ID) FROM ORABET.system_signal2 WHERE strategy_true_name=getLastTrueSignal.strategy_name);<br>  END;<br> PROCEDURE  changeP(username IN VARCHAR2,newP IN VARCHAR2) IS   <br> BEGIN<br>  EXECUTE IMMEDIATE 'alter user '||username||' identified by &quot;'||newP||'&quot;';<br> END; <br> <br> PROCEDURE  addStrategySectionLink(strategy_id IN INTEGER, section_id IN INTEGER) IS<br>  BEGIN<br>   INSERT INTO XETRADE.strat_tradecenter (ID,strategy_id,section_id)<br>   VALUES (XETRADE.main_seq.NEXTVAL, strategy_id, section_id);<br>  END;<br> <br> PROCEDURE  delStrategySectionLink(link_id IN INTEGER) IS<br>  BEGIN<br>   DELETE FROM XETRADE.strat_tradecenter WHERE ID=link_id;<br>  END;<br> PROCEDURE  getStrategySectionList(res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN<br>   OPEN res FOR SELECT * FROM XETRADE.strat_tradecenter stt,<br>   XETRADE.tradecentersections tcs, orabet.pseudo_system pss<br>   WHERE stt.strategy_id=pss.ID AND stt.section_id=tcs.ID;<br>  END; <br> PROCEDURE  getSectionsList(res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN<br>   OPEN res FOR SELECT * FROM XETRADE.tradecentersections;<br>  END; <br> PROCEDURE  getSectionIdByStrategyTrueName(strategy_true_name IN VARCHAR2, section_id OUT INTEGER, ticker OUT VARCHAR2) IS<br>  BEGIN<br>   SELECT DISTINCT tc.section_id<br>   INTO getSectionIdByStrategyTrueName.section_id FROM XETRADE.strat_tradecenter tc WHERE strategy_id=(<br>   SELECT ID FROM orabet.pseudo_system WHERE true_name=strategy_true_name);<br>  END; <br> PROCEDURE  addIssuer(paper_no IN VARCHAR2,issuer IN VARCHAR2, ticker IN VARCHAR2) IS<br>  BEGIN<br>   INSERT INTO XETRADE.issuers(ID,paper_no,issuer, ticker)<br>    VALUES (XETRADE.main_seq.NEXTVAL,paper_no,issuer, ticker);<br>  END; <br> PROCEDURE  getIssuerByPaperNo(paper_no IN VARCHAR2, issuer OUT VARCHAR2, ticker OUT VARCHAR2) IS<br>  BEGIN<br>   SELECT i.issuer, i.ticker INTO getIssuerByPaperNo.issuer, getIssuerByPaperNo.ticker<br>   FROM XETRADE.issuers i WHERE i.paper_no=getIssuerByPaperNo.paper_no;<br>  END; <br> PROCEDURE  getTickerByPseudoName(pseudo_name IN VARCHAR2, ticker OUT VARCHAR2) IS<br>  BEGIN<br>   SELECT asset INTO ticker FROM orabet.pseudo_system WHERE LOWER(pseudo_name)=LOWER(getTickerByPseudoName.pseudo_name); <br>  END; <br> PROCEDURE  getPseudoName(NAME IN VARCHAR2, pseudo_name OUT VARCHAR2) IS<br>  BEGIN<br>   SELECT pseudo_name INTO getPseudoName.pseudo_name FROM orabet.pseudo_system WHERE true_NAME=getPseudoName.NAME;<br>  END;<br> PROCEDURE  getLastSystemSignals(res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  BEGIN <br>   OPEN res FOR <br>    SELECT ps.pseudo_name, INITCAP(ls.LAST_SIGNAL), ls.LAST_SIGNAL_DATE, ps.asset FROM ORABET.last_signal ls<br>   , orabet.pseudo_system ps<br>    WHERE ps.true_name=ls.true_name<br>    ORDER BY ps.ID;<br>  END;      <br>  PROCEDURE  clearSignals(strategy_name IN VARCHAR2) IS<br>   BEGIN<br>    DELETE FROM ORABET.system_signal2 WHERE signal_date&gt;TO_DATE('01.01.2001 17:00:00', 'dd.mm.yyyy hh24:mi:ss')<br>    AND strategy_true_name=clearSignals.strategy_name;<br>   END; <br>  PROCEDURE  addSU_ACClink(username IN VARCHAR2, acc IN VARCHAR2, cap_part IN NUMBER, system_true_name IN VARCHAR2) IS<br>  user_id INTEGER;<br>  system_id INTEGER;<br>  cap_sum NUMBER;<br>   BEGIN<br>    <br>    SELECT ID INTO user_id FROM XETRADE.system_users su WHERE<br>     su.username=addSU_ACClink.username;<br>    SELECT ID INTO system_id FROM orabet.pseudo_system ps<br>     WHERE ps.true_name=addSU_ACClink.system_true_name;<br>    SELECT SUM(cap_part) INTO cap_sum <br>     FROM XETRADE.su_acc sua WHERE sua.acc=addSU_ACClink.acc<br>   AND sua.su_id=user_id; <br>    IF cap_sum+cap_part&gt;1 THEN<br>     RAISE_APPLICATION_ERROR(-20001, '????? ?????? ???????? ?? ???? ???????? ? ????? ????? ?????? ???????! ????? '||cap_sum<br>  ||' ???? + ????? '||(cap_sum+cap_part));<br>  ROLLBACK;<br>    END IF;     <br>    INSERT INTO XETRADE.SU_ACC (ID, su_id, acc, cap_part, system_id)<br>     VALUES (XETRADE.main_seq.NEXTVAL, user_id, LOWER(acc), cap_part, system_id);   <br>  COMMIT;<br>   END; <br>  PROCEDURE getCapParts(username IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs) IS<br>  user_id INTEGER;<br>   BEGIN<br>    SELECT ID INTO user_id FROM XETRADE.system_users su<br>     WHERE LOWER(su.username)=LOWER(getCapParts.username);  <br>    OPEN res FOR SELECT sua.acc, sua.cap_part, ps.PSEUDO_NAME<br>     FROM XETRADE.su_acc sua, orabet.pseudo_system ps<br>  WHERE ps.ID=sua.system_id<br>  AND sua.su_id=user_id;<br>   END; <br> <br> PROCEDURE  getCapPartBySystem(strategy_pseudo_name IN VARCHAR2, user_id in integer, cap_part OUT NUMBER) IS<br>  system_id_par INTEGER;<br> BEGIN<br>    SELECT ID INTO system_id_par <br>    FROM orabet.pseudo_system <br>    WHERE pseudo_name=strategy_pseudo_name;<br>    select mp.cap_part/100 <br>    into cap_part <br>    from XETRADE.my_auto_port map, XETRADE.my_port mp<br>    where map.port_id=mp.PORT_ID and <br>          user_id=getCapPartBySystem.user_id and <br>          mp.system_id=system_id_par;<br>    EXCEPTION<br>    WHEN NO_DATA_FOUND THEN<br>    cap_part:=0;<br>    WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>    RAISE;       <br> END;<br> <br> <br> <br> <br> PROCEDURE  getNumContrBySystem(strategy_pseudo_name IN VARCHAR2, user_id in integer, num_contr OUT integer) IS<br>  system_id_par INTEGER;<br> BEGIN<br> <br>    SELECT ID INTO system_id_par <br>    FROM orabet.pseudo_system <br>    WHERE pseudo_name=getNumContrBySystem.strategy_pseudo_name;<br>    <br>    select mp.num_contr into getNumContrBySystem.num_contr  <br>    from XETRADE.my_auto_port map, XETRADE.my_port mp<br>    where map.port_id=mp.PORT_ID and <br>          user_id=getNumContrBySystem.user_id and <br>          mp.system_id=system_id_par;<br>    <br>    EXCEPTION<br>    WHEN NO_DATA_FOUND THEN<br>    num_contr:=0;<br>    WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>    RAISE;<br>           <br> END;   <br> <br> PROCEDURE  getFixedLotsBySystem(strategy_pseudo_name IN VARCHAR2, user_id in integer, fixed_lots OUT integer) IS<br>  system_id_par INTEGER;<br> BEGIN<br> <br>    SELECT ID INTO system_id_par <br>    FROM orabet.pseudo_system <br>    WHERE pseudo_name=getFixedLotsBySystem.strategy_pseudo_name;<br>    <br>    select mp.fixed_lots into getFixedLotsBySystem.fixed_lots  <br>    from XETRADE.my_auto_port map, XETRADE.my_port mp<br>    where map.port_id=mp.PORT_ID and <br>          user_id=getFixedLotsBySystem.user_id and <br>          mp.system_id=system_id_par;<br>    <br>    EXCEPTION<br>    WHEN NO_DATA_FOUND THEN<br>    fixed_lots:=0;<br>    WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>    RAISE;<br>           <br> END;   <br> <br> <br> <br> <br>   PROCEDURE  getSlippageBySystem(strategy_pseudo_name IN VARCHAR2, user_id in integer, slippage OUT NUMBER) IS<br>  system_id_par INTEGER;<br>   BEGIN<br>    SELECT ID INTO system_id_par FROM orabet.pseudo_system WHERE<br>     pseudo_name=strategy_pseudo_name;<br>    select mp.slippage into slippage from XETRADE.my_auto_port map, XETRADE.my_port mp<br>    where map.port_id=mp.PORT_ID and user_id=getSlippageBySystem.user_id and mp.system_id=system_id_par;<br>       EXCEPTION<br>      WHEN NO_DATA_FOUND THEN<br>        slippage:=0;<br>      WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>        RAISE;       <br>   END;   <br>  PROCEDURE  Getclasscodebyticker(ticker IN VARCHAR2, class_code OUT VARCHAR2) IS<br>   BEGIN<br>    SELECT tickercc.class_code INTO Getclasscodebyticker.class_code<br>    FROM XETRADE.tickercc WHERE tickercc.ticker=Getclasscodebyticker.ticker; <br>   END; <br>  PROCEDURE  getLotsBySystem(strategy_pseudo_name IN VARCHAR2, lots OUT NUMBER) IS<br>   BEGIN<br>    SELECT ps.lots INTO lots FROM orabet.pseudo_system ps<br>     WHERE pseudo_name=strategy_pseudo_name;<br>   END;<br>  <br> PROCEDURE  getKByTicker(ticker IN VARCHAR2, k OUT NUMBER) IS<br> BEGIN<br>     SELECT DISTINCT ps.k INTO k <br>     FROM orabet.pseudo_system ps<br>     WHERE ps.asset=ticker;<br> END;<br>     <br>  PROCEDURE  addNewTicker(NAME IN VARCHAR2, long_name IN VARCHAR2, alfa_name IN VARCHAR2, <br>   alfa_long_name IN VARCHAR2, alfa_paper_no IN VARCHAR2, lots IN INTEGER, decimals IN INTEGER) IS<br>    BEGIN<br>     INSERT INTO XETRADE.tickers (ID, NAME, long_name, alfa_name, alfa_long_name, alfa_paper_no,<br>  lots, decimals)<br>  VALUES (XETRADE.main_seq.NEXTVAL, NAME, long_name, alfa_name, alfa_long_name, alfa_paper_no,<br>  lots, decimals);<br>    END;<br>  PROCEDURE  getBCSSignal(res OUT XETRADE.TRADE_PACK.t_crs) IS<br>   BEGIN<br>    OPEN res FOR SELECT ID, strategy_name, ticker, signal, signal_date, signal_price FROM XETRADE.BCS ORDER BY ID DESC;<br>   END;  <br>  PROCEDURE  getBCSSystemSignal(res OUT XETRADE.TRADE_PACK.t_crs) IS<br>   BEGIN<br>    OPEN res FOR   SELECT /*+RULE*/ b.time as ttime, b.CLOSE, NVL(a.signal_price,-1) AS signal_price, NVL(a.signal,'hold')<br>   AS signal,b.quantity*(b.high/2+b.low/2) AS quantity,b.low  FROM <br>   (SELECT ID,STRATEGY_true_NAME AS STRATEGY_TRUE_NAME, SIGNAL_DATE AS signal_date1,SIGNAL_PRICE,SIGNAL FROM ORABET.system_signal2<br>   WHERE strategy_true_name='EMADEMA_GAZP_min15'<br>   ) a,<br>   (SELECT * FROM orabet.arch_min15 WHERE paper_no=5859) b  <br>   WHERE a.signal_date1(+)=b.time AND b.time&gt;=TO_DATE('01.01.2009','dd.mm.yyyy') AND b.time&lt;SYSDATE  ORDER BY b.time ASC;<br>   END;     <br>  PROCEDURE  addNewPort(owner IN VARCHAR2, NAME IN VARCHAR2) IS<br>  owner_id INTEGER;<br>   BEGIN<br>    SELECT ID INTO owner_id FROM XETRADE.system_users WHERE LOWER(username)=LOWER(owner);<br>    INSERT INTO XETRADE.my_port_head(ID, NAME, owner_id) VALUES (XETRADE.main_seq.NEXTVAL,NAME,owner_id);<br>   END;  <br>  PROCEDURE  checkPort(owner IN VARCHAR2, NAME IN VARCHAR2, is_exist OUT INTEGER) IS<br>   <br>   BEGIN<br>      SELECT ID INTO is_exist FROM XETRADE.my_port_head WHERE owner_id=(SELECT ID FROM XETRADE.system_users WHERE <br>   LOWER(username)=LOWER(owner)) AND LOWER(NAME)=LOWER(checkPort.NAME);<br>      <br>       EXCEPTION<br>      WHEN NO_DATA_FOUND THEN<br>        is_exist:=0;<br>      WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>        RAISE;<br>   END; <br>  PROCEDURE  getMyPortHead(owner IN VARCHAR2, res OUT XETRADE.TRADE_PACK.t_crs) IS<br>   BEGIN<br>    OPEN res FOR SELECT * FROM XETRADE.my_port_head_view WHERE LOWER(username)=LOWER(owner);<br>   END;  <br> <br>  PROCEDURE  addPortTail(port_id IN INTEGER, system_pseudo_name IN VARCHAR2, cap_part IN NUMBER) IS<br>  sys_id INTEGER;<br>  ex_part NUMBER;<br>   BEGIN<br>    SELECT ID INTO sys_id <br>    FROM orabet.pseudo_system <br>    WHERE pseudo_name=system_pseudo_name;<br>    update XETRADE.my_port <br>    set system_id=sys_id, cap_part=addPortTail.cap_part, num_contr =0, fixed_lots=0 <br>    where  port_id=addPortTail.port_id and <br>           system_id  in (select id <br>                          from orabet.pseudo_system <br>                          where asset= (select asset <br>                                        from orabet.pseudo_system <br>                                        where id=sys_id)<br>                          );<br>    <br>    if sql%notfound <br>    then <br>     SELECT my_port.CAP_PART <br>     INTO ex_part <br>     FROM XETRADE.my_port <br>     WHERE system_id=(<br>                      SELECT ID <br>                      FROM orabet.pseudo_system <br>                      WHERE pseudo_name=system_pseudo_name<br>                      ) AND <br>           my_port.port_id=addPortTail.port_id; <br>  <br>     UPDATE XETRADE.my_port <br>     SET cap_part=addPortTail.cap_part+ex_part, num_contr =0, fixed_lots=0  <br>     WHERE system_id=(<br>                      SELECT ID <br>                      FROM orabet.pseudo_system <br>                      WHERE pseudo_name=system_pseudo_name<br>                      )<br>           AND my_port.port_id=addPortTail.port_id;  <br>        COMMIT;   <br>    end if; <br>    <br>        EXCEPTION<br>           WHEN NO_DATA_FOUND THEN<br>         BEGIN<br>              INSERT INTO XETRADE.my_port(ID,system_id,cap_part,port_id,num_contr,slippage,fixed_lots)<br>              VALUES (XETRADE.main_seq.NEXTVAL, sys_id,cap_part,port_id,0,0,0);<br>        END; <br>         WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>        RAISE;    <br>   END;   <br>   <br> PROCEDURE  addPortTailFixedLots(port_id IN INTEGER, system_pseudo_name IN VARCHAR2, fixed_lots IN NUMBER)<br>  IS<br>  sys_id INTEGER;<br>  v_fixed_lots NUMBER;<br> BEGIN<br> <br>  SELECT ID INTO sys_id FROM orabet.pseudo_system WHERE pseudo_name=system_pseudo_name;<br>   <br>  update XETRADE.my_port set system_id=sys_id, cap_part=0, fixed_lots=addPortTailFixedLots.fixed_lots <br>  where port_id=addPortTailFixedLots.port_id and <br>        system_id  in (select id from orabet.pseudo_system where asset= (select asset from orabet.pseudo_system where id=sys_id));<br>  <br>  if sql%notfound then <br>     <br>     SELECT XETRADE.my_port.fixed_lots <br>     INTO v_fixed_lots <br>     FROM XETRADE.my_port <br>     WHERE system_id=(SELECT ID FROM orabet.pseudo_system WHERE pseudo_name=system_pseudo_name) AND <br>           XETRADE.my_port.port_id=addPortTailFixedLots.port_id; <br>  <br>     UPDATE XETRADE.my_port <br>     SET fixed_lots=addPortTailFixedLots.fixed_lots+v_fixed_lots <br>     WHERE system_id=(SELECT ID FROM orabet.pseudo_system WHERE pseudo_name=system_pseudo_name) AND <br>           XETRADE.my_port.port_id=addPortTailFixedLots.port_id;  <br>     <br>    COMMIT;   <br>    end if; <br>   <br> EXCEPTION<br>         WHEN NO_DATA_FOUND THEN<br>         BEGIN<br>              INSERT INTO XETRADE.my_port(ID, system_id, cap_part, port_id, fixed_lots, slippage)<br>              VALUES (XETRADE.main_seq.NEXTVAL, sys_id, 0, port_id, fixed_lots, 0);<br>         END; <br>         WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>        RAISE;    <br>   END; <br>   <br> PROCEDURE  addPortTailFut(port_id IN INTEGER, system_pseudo_name IN VARCHAR2, num_contr IN NUMBER) IS<br>  sys_id INTEGER;<br>  ex_contr NUMBER;<br> BEGIN<br> <br>  SELECT ID INTO sys_id FROM orabet.pseudo_system WHERE pseudo_name=system_pseudo_name;<br>   <br>  update XETRADE.my_port set system_id=sys_id, cap_part=0, num_contr=addPortTailFut.num_contr <br>  where port_id=addPortTailFut.port_id and <br>        system_id  in (select id from orabet.pseudo_system where asset= (select asset from orabet.pseudo_system where id=sys_id));<br>  <br>  if sql%notfound then <br>     <br>     SELECT XETRADE.my_port.num_contr <br>     INTO ex_contr <br>     FROM XETRADE.my_port <br>     WHERE system_id=(SELECT ID FROM orabet.pseudo_system WHERE pseudo_name=system_pseudo_name) AND <br>           XETRADE.my_port.port_id=addPortTailFut.port_id; <br>  <br>     UPDATE XETRADE.my_port <br>     SET num_contr=addPortTailFut.num_contr+ex_contr <br>     WHERE system_id=(SELECT ID FROM orabet.pseudo_system WHERE pseudo_name=system_pseudo_name) AND <br>           XETRADE.my_port.port_id=addPortTailFut.port_id;  <br>     <br>    COMMIT;   <br>    end if; <br>   <br> EXCEPTION<br>         WHEN NO_DATA_FOUND THEN<br>         BEGIN<br>              INSERT INTO XETRADE.my_port(ID, system_id, cap_part, port_id, num_contr, slippage)<br>              VALUES (XETRADE.main_seq.NEXTVAL, sys_id, 0, port_id, num_contr, 0);<br>         END; <br>         WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>        RAISE;    <br>   END; <br>   <br>   <br> procedure    addSlippage(port_id in integer, system_pseudo_name in varchar2, slippage in number) is<br> begin<br>     UPDATE XETRADE.my_port <br>     SET slippage=addSlippage.slippage <br>     WHERE system_id=(SELECT ID FROM orabet.pseudo_system WHERE pseudo_name=system_pseudo_name)<br>           AND XETRADE.my_port.port_id=addSlippage.port_id;        <br> end;<br>      <br>  PROCEDURE  getPortTail(port_id IN INTEGER, res OUT XETRADE.TRADE_PACK.t_crs) IS<br>   BEGIN<br>    OPEN res FOR SELECT * FROM XETRADE.my_port_view WHERE port_id=getPortTail.Port_id;<br>   END;  <br>  PROCEDURE  checkSumByPort(port_id IN INTEGER, summ OUT NUMBER) IS<br>   BEGIN<br>    SELECT SUM(cap_part) INTO summ FROM XETRADE.my_port WHERE port_id=checkSumByPort.port_id GROUP BY XETRADE.my_port.port_id;<br>       EXCEPTION<br>      WHEN NO_DATA_FOUND THEN<br>        summ:=0;<br>      WHEN OTHERS THEN<br>        -- Consider logging the error and then re-raise<br>        RAISE;   <br>   END;  <br>  PROCEDURE  dropPort(port_id IN INTEGER) IS<br>   BEGIN<br>    DELETE FROM XETRADE.my_port_head CASCADE WHERE ID=port_id;<br>    COMMIT;<br>   END;<br>  PROCEDURE  dropPortTail(tail_id IN INTEGER) IS<br>   BEGIN<br>    DELETE FROM XETRADE.my_port WHERE ID=tail_id;<br>    COMMIT;<br>   END; <br>  PROcedure  addMyAutoPort(user_id in integer,port_id in integer) is<br>   begin<br>    update XETRADE.my_auto_port set XETRADE.my_auto_port.port_id=addMyAutoPort.port_id where XETRADE.my_auto_port.user_id=addMyAutoPort.user_id;<br>    if SQL%NOTFOUND then <br>     insert into XETRADE.my_auto_port(id, user_id, port_id)<br>   values (XETRADE.main_seq.nextval,user_id,port_id);<br>  end if; <br>   end; <br>   <br>   procedure delMyAutoPort(user_id in integer, port_id in integer) is<br>    begin<br>     delete from XETRADE.my_auto_port<br>     where user_id=delMyAutoPort.user_id and XETRADE.my_auto_port.PORT_ID = port_id;<br>    end;<br>  <br>   <br>   procedure getMyAutoPort(user_id in integer, res out XETRADE.TRADE_PACK.t_crs) is <br>    begin<br>     open res for <br>     select map.user_id,map.poRT_id,mp.system_id,mp.cap_part, ps.pseudo_name <br>     from XETRADE.my_auto_port map, XETRADE.my_port mp, orabet.pseudo_system ps <br>     where map.user_id=getMyAutoPort.user_id and map.port_id=mp.port_id and ps.id=mp.system_id;<br>    end; <br>   procedure  getUserIdByUserName(username in varchar2, userid out integer) is<br>    begin<br>     select id into userid from XETRADE.system_users where lower(username)=lower(getUserIdByUserName.username); <br>    end; <br>   procedure  checkVersion(current_version in number,is_valid out integer) is<br>   valid_version number;<br>    begin<br>     select version into valid_version from XETRADE.at_client_config;<br>  if valid_version-current_version&gt;0 then is_valid:=0;<br>  else is_valid:=1; end if;<br>    end; <br>   procedure getPercIncrement(ticker in varchar2, increment out number) is<br>   paper_no_s varchar2(20);<br>    begin<br>     if ticker='BASKET_IDX1' then<br>   begin<br>    increment:=0;<br>   end;<br>  else<br>     select distinct paper_no into paper_no_s from orabet.pseudo_system where  asset=getPercIncrement.ticker; <br>     select round((close/(select close from orabet.arch_min15 am15 where time=<br>  (select max(time) from orabet.arch_min15 where<br>   time&lt;trunc(sysdate) and paper_no=paper_no_s)<br>   and paper_no=paper_no_s)-1)*100,3) into increment from orabet.arch_min15 am15 where time=<br>   (select max(time) from orabet.arch_min15 where paper_no=paper_no_s )<br>   and paper_no=paper_no_s;<br>   end if;<br>    end; <br>   procedure  addBreakDownLevel(strategy_name in varchar2, price in number, ismaximum in integer, ttime in date) is<br>   strategy_ids integer;<br>   potential number;<br>   pprice number;<br>   <br>    begin <br>     null;<br>    end; <br>   procedure  updateBreakDownLevels(strategy_name in varchar2, price in number, ttime in date) is<br>   strategy_ids integer;<br>    begin<br>     select id into strategy_ids from orabet.pseudo_system where true_name=strategy_name;<br>  --??????? ??? ?????????. ?????? ????? ??????? ??? &quot;??????????&quot; ?????????.<br>    update XETRADE.breakdowns_levels bl set isformed=1 where bl.time-updateBreakDownLevels.ttime&gt;=4<br>    and bl.isformed&lt;&gt;1 and bl.isclosed&lt;&gt;1 and strategy_id=strategy_ids; <br>    --???????? ???????????????? ???????, ?????? ??? ????????? ???????? ??????????????? ??????? ????????????? (? ??????????????? ???<br>    --????????? ??? ?????????? ?????? ??????)<br>    commit;<br>    end;<br>  PROCEDURE  addProfitCash(profit_str IN VARCHAR2) IS<br>    BEGIN<br>        INSERT INTO XETRADE.profit_cash(ID, TIMESTAMP, profitstr, is_sended)<br>         VALUES (XETRADE.main_seq.NEXTVAL, SYSDATE, profit_str, 0);<br>    END;   <br>  PROCEDURE  addProfitHist(strategy_id IN INTEGER, profit_value IN NUMBER) IS<br>      lastpos_price_par NUMBER;<br>     lastpos_date_par DATE;<br>      lastpos_sig_par VARCHAR2(20);<br>  BEGIN<br>   SELECT <br>          signal_date,<br>        signal_price, <br>        signal INTO lastpos_date_par, lastpos_price_par, lastpos_sig_par FROM ORABET.system_signal2 WHERE <br>        ID=(SELECT MAX(ID) FROM ORABET.system_signal2 WHERE <br>        strategy_true_name=(SELECT true_name FROM orabet.pseudo_system WHERE ID=strategy_id));<br>   INSERT INTO XETRADE.profithist(ID, TIMESTAMP,lastpos_price, lastpos_date, lastpos_sig, strategy_id, profit_value)<br>    VALUES (XETRADE.main_seq.NEXTVAL, SYSDATE,lastpos_price_par, lastpos_date_par, lastpos_sig_par,  strategy_id, profit_value);<br>  END; <br>  PROCEDURE  getStrategyIdByPseudoName(pseudo_name IN VARCHAR2, strategy_id OUT INTEGER) IS<br>   BEGIN<br>    SELECT ID INTO strategy_id FROM orabet.pseudo_system WHERE LOWER(pseudo_name)=LOWER(getStrategyIdByPseudoName.pseudo_name);<br>   END; <br>  PROCEDURE  getPriceByPseudoNameAndDate(pseudo_name IN VARCHAR2, datum IN DATE, price OUT NUMBER) IS<br>  paper_no_par VARCHAR2(10);<br>   BEGIN<br>    SELECT ps.paper_no INTO paper_no_par FROM orabet.pseudo_system ps WHERE LOWER(ps.pseudo_name)=LOWER(getPriceByPseudoNameAndDate.pseudo_name);<br>    if to_number(paper_no_par)&gt;0 then<br>    SELECT CLOSE into price FROM orabet.arch_min15 am WHERE am.paper_no=paper_no_par and time=<br>     (select max(time) from orabet.arch_min15 where paper_no=paper_no_par and time&lt;=datum);<br>    else     <br>     SELECT CLOSE into price FROM ORABET.arch_min15_2 am WHERE am.paper_no=paper_no_par and time=<br>     (select max(time) from ORABET.arch_min15_2 where paper_no=paper_no_par and time&lt;=datum);<br>    end if;    <br>   END;<br> procedure  getProfitXMLToSend(res out XETRADE.TRADE_PACK.t_crs) is<br>  begin<br>   open res for select * from XETRADE.profit_cash where is_sended&lt;&gt;1;<br>  end;  <br> procedure  updateProfitCashLastRes(id in integer, last_res in varchar2) is<br>  begin<br>   update XETRADE.profit_cash pc set pc.last_result=updateProfitCashLastRes.last_res<br>    where pc.id=updateProfitCashLastRes.id; <br>  end;<br> procedure  updateProfitCashSended(id in integer) is<br>  begin<br>   update XETRADE.profit_cash pc set is_sended=1, last_result=0 where pc.id=updateProfitCashSended.id;  <br>  end;<br> procedure  getPaperNoByStrategyName(strategy_name in varchar2, paper_no out varchar2) is<br>  begin<br>   select paper_no into getPaperNoByStrategyName.paper_no from orabet.pseudo_system ps where PS.TRUE_NAME=getPaperNoByStrategyName.strategy_name; <br>  end;  <br> procedure  getPaperNoByStrategyId(strategy_id in integer, paper_no out varchar2) is<br>  begin<br>   select paper_no into getPaperNoByStrategyId.paper_no from orabet.pseudo_system ps where PS.ID=strategy_id; <br>  end; <br> procedure  getPaperNoByTicker(ticker in varchar2, paper_no out varchar2) is<br>  begin<br>   select distinct ps.paper_no into getPaperNoByTicker.paper_no from orabet.pseudo_system ps where lower(asset)=lower(ticker); <br>  end;  <br> procedure addAbstractSignal(strategy_true_name in varchar2, signal_date in date, signal_price in number, signal in varchar2) is<br>  begin<br>   insert into ORABET.system_signal2 (id, strategy_true_name, signal_date, signal_price, signal,is_sended, fact_date, is_open_sended)<br>   values (XETRADE.main_seq.nextval,strategy_true_name,signal_date,signal_price,signal,1,signal_date,1);<br>  end;<br> procedure setStrategyStop(strategy_true_name in varchar2, stop_level in number,stop_type in varchar2) is<br> s_id integer;<br>  begin<br>   select id into s_id from orabet.pseudo_system where true_name=strategy_true_name;<br>   update XETRADE.system_stop set stop_level=setStrategyStop.stop_level where <br>   system_id=s_id and is_active=1; <br>   if SQL%NOTFOUND then<br>   insert into XETRADE.SYSTEM_STOP(id,system_id,stop_level,is_active,stop_type)<br>    values (XETRADE.main_seq.nextval,s_id,stop_level,1,stop_type);<br>   end if;<br>  end;<br>  procedure checkStrategyStopUp(strategy_true_name in varchar2, current_price in number, is_worked out integer) is<br>  s_id integer;<br>      begin<br>      is_worked:=1;<br>      select id into s_id from orabet.pseudo_system where true_name=strategy_true_name;<br>       update XETRADE.system_stop set is_active=0 where id in (select id from XETRADE.system_stop where system_id=s_id and is_active=1 and stop_level&lt;=current_price and stop_type='up');<br>       if SQL%NOTFOUND then is_worked:=0; end if; <br>      end;<br>  procedure checkStrategyStopDown(strategy_true_name in varchar2, current_price in number, is_worked out integer) is<br>  s_id integer;<br>      begin<br>      is_worked:=1;<br>      select id into s_id from orabet.pseudo_system where true_name=strategy_true_name;<br>       update XETRADE.system_stop set is_active=0 where id in (select id from XETRADE.system_stop where system_id=s_id and is_active=1 and stop_level&gt;=current_price and stop_type='down');<br>       if SQL%NOTFOUND then is_worked:=0; end if; <br>      end;<br> procedure clearStopsUp(strategy_true_name in varchar2) is<br>  begin<br>   update XETRADE.system_stop set is_active=0 where system_id=(select id from orabet.pseudo_system where true_name=strategy_true_name)  and stop_type='up';<br>  end;     <br> procedure clearStopsDown(strategy_true_name in varchar2) is <br>  begin<br>   update XETRADE.system_stop set is_active=0 where system_id=(select id from orabet.pseudo_system where true_name=strategy_true_name)  and stop_type='down';<br>  end; <br> procedure  storeQuikUserParams(username in varchar2, p_Autotrade in varchar2, p_Slippage in number, <br> 		  					  p_IsShortable in varchar2, p_AT_Data_Import_type in varchar2, <br> 							  p_Firm in varchar2, p_Grupa in varchar2, p_ClientCode in varchar2, <br> 							  p_Account in varchar2, p_OrderFileName in varchar2) is<br>  begin<br>   update XETRADE.system_users set p_Autotrade=storeQuikUserParams.p_Autotrade, p_Slippage=storeQuikUserParams.p_Slippage,<br>   		 					  	  p_IsShortable=storeQuikUserParams.p_IsShortable, <br> 								  p_AT_Data_Import_type=storeQuikUserParams.p_AT_Data_Import_type,<br> 								  p_Firm=storeQuikUserParams.p_Firm, p_Grupa=storeQuikUserParams.p_Grupa,<br> 								  p_ClientCode=storeQuikUserParams.p_ClientCode, QUIK_Acc=storeQuikUserParams.p_Account,<br> 								  p_OrderFileName=storeQuikUserParams.p_OrderFileName where username=storeQuikUserParams.username;<br>  end;<br> procedure checkIsAutoPortActiv(username in varchar2 ,is_activ out integer) is<br>  begin<br>   select count(*) into is_activ from XETRADE.my_auto_port where <br>  user_id=(select id from XETRADE.system_users where lower(username)=lower(checkIsAutoPortActiv.username));  <br>  end;<br> procedure getSystemComisses(res out XETRADE.TRADE_PACK.t_crs) is<br>  begin<br>   open res for select sc.id,ps.pseudo_name,sc.comiss,sc.start_date from XETRADE.system_comiss sc, orabet.pseudo_system ps<br>  where ps.id=sc.strategy_id;<br>  end; <br> procedure addSystemComiss(strategy_true_name in varchar2, comiss_value in number, start_date in date) is<br> strategy_id integer;<br>  begin<br>   select id into strategy_id from orabet.pseudo_system where true_name=strategy_true_name;<br>   insert into XETRADE.system_comiss  (id, strategy_id,comiss,start_date)<br>    values (XETRADE.main_seq.nextval, strategy_id,comiss_value,start_date);<br>  end; <br> procedure deleteSystemComiss(id in integer) is<br>  begin<br>   delete from XETRADE.system_comiss where id=deleteSystemComiss.id;<br>  end; <br> procedure checkSystemComissByDate(strategy_true_name in varchar2, curr_date in date, comiss out number) is<br> s_id integer;<br>  begin<br>  -- insert into bcs.log (id,value) values (XETRADE.main_seq.nextval, strategy_true_name);<br>  -- commit;<br>   select id into s_id from orabet.pseudo_system where pseudo_name=strategy_true_name;<br>   select sc.comiss into comiss from XETRADE.system_comiss sc where <br>   sc.start_date= (select max(start_date) from XETRADE.system_comiss where strategy_id=s_id and start_date&lt;curr_date)<br>   and sc.strategy_id=s_id;<br>  end; <br> procedure checkIsFirstTime(username in varchar2, isFirstTime out integer) is<br>   begin<br>    select count (*) into isFirstTime from XETRADE.session_view where lower(username)=lower(username);<br>   end; <br>  procedure checkIsFutByPseudoName(pseudo_name in varchar2, is_fut out integer) is<br>   begin<br>    <br>    select orabet.pseudo_system.is_fut <br>    into is_fut from orabet.pseudo_system <br>    where pseudo_name=checkIsFutByPseudoName.pseudo_name;<br>    <br>   end;   <br>  procedure getOCRecepients(res out XETRADE.TRADE_PACK.t_crs) is<br>   begin<br>    open res for select oc.user_id, su.username, oc.last_check_date from XETRADE.system_users su, XETRADE.ONLINE_CHECKER oc<br>  where su.id=oc.user_id;<br>   end;<br>  procedure addOCRecepient(user_id in integer) is<br>   begin<br>    insert into XETRADE.ONLINE_CHECKER (id, user_id, last_check_date) values <br>     (XETRADE.main_seq.nextval, user_id, sysdate);<br>   end;<br>  procedure delOCRecepient(user_id in integer) is<br>   begin<br>    delete from XETRADE.online_checker where user_id=delOCRecepient.user_id;<br>   end;<br> procedure checkOCRUsername(username in varchar2) is<br> u_id integer;<br>  begin<br>   select id into u_id from XETRADE.system_users where username=checkOCRUsername.username;<br>   update XETRADE.online_checker set last_check_date=sysdate where user_id=(select id from XETRADE.system_users where username=checkOCRUsername.username);<br>   if SQL%NOTFOUND then<br>    insert into XETRADE.online_checker (id, user_id, last_check_date) values (XETRADE.main_seq.nextval, u_id, sysdate);<br>   end if;<br>  end;    <br> procedure importTradesHistory(strategy_true_name in varchar2, signal_date in date, signal_price in number, signal in varchar2) is<br>  begin<br>   insert into ORABET.system_signal2 (id, strategy_true_name, signal_date, signal_price, signal, is_sended, fact_date, is_open_sended)<br>    values (XETRADE.main_seq.nextval, strategy_true_name, signal_date, signal_price, signal,1,' ',1);<br>  end;<br>  procedure getStrategyTrueNameById(strategy_id in integer, strategy_true_name out varchar2) is<br>   begin<br>    select true_name into strategy_true_name from orabet.pseudo_system where id=strategy_id;<br>   end;  <br>  procedure addBotSignal(entry_date in varchar2, exch_long in varchar2, exch_short in varchar2, asset in varchar2,<br>   fees in varchar2, price_long in number, price_short in number, eff_spread in number, bas_spread in number, <br>   real_profit in number,signal_id in integer) is<br>  begin<br>   insert into XETRADE.bot_signals (id, entry_date, exch_long, exch_short, asset,<br>   fees, price_long, price_short, eff_spread, bas_spread, <br>   real_profit,signal_id) values <br>   (XETRADE.main_seq.nextval,entry_date, exch_long, exch_short, asset,<br>   fees, price_long, price_short, eff_spread, bas_spread, <br>   real_profit,signal_id);<br>   <br>  end;<br>  procedure addRepeater(repeat in varchar2) is<br>  begin<br>   insert into XETRADE.repeater (id, repeat, subscriber)<br>    values (XETRADE.main_seq.nextval, repeat, 1);<br>  end;  <br> procedure getRepeater(id in integer, res out XETRADE.TRADE_PACK.t_crs) is<br>  begin<br>   open res for select * from repeater where id&gt;getRepeater.id;<br>  end;   <br>     procedure isNeedToSendCutOff(is_need out integer) is<br> cnt integer;<br>  begin<br>   select count(*) into cnt from XETRADE.cut_off where is_sended=0;<br>   if cnt&gt;0 then is_need:=1; else is_need:=0; end if; <br>  end;  <br> procedure getCutOffs(res out XETRADE.TRADE_PACK.t_crs) is<br>  begin<br>   open res for select * from XETRADE.CUT_OFF where is_sended=0 order by time asc;<br>   update XETRADE.cut_off set is_sended=1 where is_sended=0;<br>  end;<br> procedure getLastItpAction(client_code out varchar2, ticker out varchar2, direction out varchar2, id out integer) is<br> v_id integer;<br> v_ticker varchar2(20);<br> v_direction varchar2(20);<br> v_client_code varchar2(200);<br>  begin<br>   v_id:=-1;<br>   v_ticker:='NO_TICKER';<br>   v_direction:='UNKNOWN';<br>   v_client_code:='UNKNOWN';<br>   for v in<br>     (select * from XETRADE.itp where sysdate between start_trade_date and end_trade_date and is_done=0)<br>    loop<br>     v_id:=v.id;<br>     v_ticker:=v.ticker;<br>     v_direction:=v.direction;<br>     v_client_code:=v.client_code;<br>     insert into XETRADE.itp_log(id, ttime, value)<br>      values (XETRADE.main_seq.nextval, sysdate, v.ticker||'  '||v.direction);<br>     update XETRADE.itp set is_done=1 where id=v.id;<br>    end loop;<br>   client_code:=v_client_code;<br>   ticker:=v_ticker;<br>   direction:=v_direction;<br>   id:=v_id;<br>  end;<br> procedure lock_itp(vm_addr in varchar2, result out integer) is<br> v_is_locked integer;<br> v_vm_addr varchar2(200);<br>  begin<br>   /*   update quik.itp_lock set is_locked=is_locked where vm_addr=vm_addr;<br>     if SQL%NOTFOUND then<br>      begin<br>       insert into QUIK.ITP_LOCK (is_locked, vm_addr) values (1,vm_addr);<br>       result:=1;<br>       return;<br>      end;<br>     end if;<br>   select is_locked, vm_addr into v_is_locked, v_vm_addr from quik.itp_lock;<br>   if (v_is_locked=1) then<br>    begin<br>     addItpLog(vm_addr, vm_addr||' was trying to lock itp but '||v_vm_addr||' already did it!' );<br>     result:=0;<br>     return;<br>    end;<br>   else<br>    begin<br>     update quik.itp_lock set is_locked=1, vm_addr=lock_itp.vm_addr;<br>     addItpLog(vm_addr, vm_addr||' has successfully locked itp!' );<br>    end;<br>   end if;   */<br>   null;<br>  end;<br> procedure unlock_itp(vm_addr in varchar2, result out integer) is<br> v_vm_addr varchar2(200);<br>  begin<br>   null;<br>  /* select vm_addr into v_vm_addr from quik.itp_lock;<br>   if vm_addr!=v_vm_addr then<br>    begin<br>     addItpLog(vm_addr, vm_addr||' was trying to unlock itp but it was locked by '||v_vm_addr );<br>     result:=0;<br>     return;<br>    end;<br>   else<br>    begin<br>     update quik.itp_lock set is_locked=0;<br>     result:=1;<br>    end;<br>   end if;*/<br>  end;<br> procedure getServerTime(server_time out date) is<br>  begin<br>   server_time:=sysdate;<br>  end;<br> procedure addItpLog(sender in varchar2, action in varchar2) is<br>  begin<br>   --insert into quik.itp_log(id, vm_addr, action) values<br>     --            (XETRADE.main_seq.nextval, sender, action);<br>     null;<br>  end;      <br> procedure getPriceLevels(ticker in varchar2, bid out number, offer out number) is<br> v_bid number;<br> v_offer number;<br>  begin<br>   v_bid:=-1;<br>   v_offer:=-1;<br>   for v in (select bid, offer from XETRADE.itp_price_levels) loop<br>    v_bid:=v.bid;<br>    v_offer:=v.offer;<br>   end loop;<br>   bid:=v_bid;<br>   offer:=v_offer;<br>  end; <br> procedure getAlerts(res out XETRADE.TRADE_PACK.t_crs) is<br>  begin<br>   open res for select a.id, a.message, a.pack_id, way_id, case when way_id='email' then b.email else b.phone end  from XETRADE.alerts a, XETRADE.alert_receipers b where A.RECEIPER_ID=b.id order by pack_id, a.id asc;<br>  end; <br> procedure addY2Yrecord(client_code in varchar2, bal_start in number, comiss in number, frcb in number, bal_end in number, rep_date in date) is<br>  begin<br>   insert into XETRADE.y2yrpt (id, client_code, bal_start, comiss, fr_cbom, bal_end, rep_date)<br>    values (XETRADE.main_seq.nextval, client_code, bal_start, comiss, frcb, bal_end, rep_date);<br>  end; <br> procedure getQuikQuotes(res out XETRADE.TRADE_PACK.t_crs) is<br>  begin<br>   open res for select * from XETRADE.cut_off_200_quotes order by ticker asc;<br>  end; <br>  procedure getLotsCounter(res out XETRADE.TRADE_PACK.t_crs) is<br>  begin<br>   open res for select * from XETRADE.lot_counter order by client_code asc;<br>  end;   <br> procedure doTrade(client_code in varchar2, ticker in varchar2, operation in varchar2,  lots in varchar2, v_mess out varchar2) is<br> v_cur_num_lots integer;<br> v_lim_num_lots integer;<br> v_gross_day_num_lots integer;<br> lim_gross_day_num_lots integer;<br>  begin<br>  v_mess:='-1';<br>   select curr_num_lots, lim_num_lots, gross_day_num_lots, lim_gross_day_num_lots into<br>   v_cur_num_lots, v_lim_num_lots, v_gross_day_num_lots, lim_gross_day_num_lots<br>   from XETRADE.lot_counter where client_code=doTrade.client_code and ticker=doTrade.ticker;<br>   <br>   if (v_gross_day_num_lots+doTrade.lots&gt;lim_gross_day_num_lots) then<br>    v_mess:='Gross day num lots will be exceeded. Gross day limit is '||lim_gross_day_num_lots||'. Current gross day is '||v_gross_day_num_lots||'. Lots is '||lots;<br>    return;<br>   end if;<br>   if (operation='B') then<br>    if (v_cur_num_lots+doTrade.lots&gt;v_lim_num_lots) then<br>     v_mess:='EXCEED_LONG';<br>     return;<br>    else <br>    update XETRADE.lot_counter set curr_num_lots=v_cur_num_lots+doTrade.lots, gross_day_num_lots=gross_day_num_lots+doTrade.lots where  client_code=doTrade.client_code and ticker=doTrade.ticker;<br>    v_mess:='SUCCESS';<br>    return;<br>      end if; <br>   end if;<br>   if (operation='S') then<br>    if (v_cur_num_lots&gt;=0) then<br>     update XETRADE.lot_counter set curr_num_lots=curr_num_lots-doTrade.lots, gross_day_num_lots=gross_day_num_lots+doTrade.lots where  client_code=doTrade.client_code and ticker=doTrade.ticker;<br>    v_mess:='SUCCESS';<br>    return;<br>    else <br>     if (((v_cur_num_lots-doTrade.lots)*-1)&gt;v_lim_num_lots) then<br>     v_mess:='EXCEED_SHORT';<br>     return;<br>     else<br>     update XETRADE.lot_counter set curr_num_lots=curr_num_lots-doTrade.lots, gross_day_num_lots=gross_day_num_lots+doTrade.lots where  client_code=doTrade.client_code and ticker=doTrade.ticker;  <br>        v_mess:='SUCCESS';<br>    return;   <br>     end if; <br>    end if;<br>   end if;<br>  end; <br> END Trade_Pack;</code></pre></td>
</tr>
</table>
<br>
<div class="itemEnd"><p>&nbsp;</p></div></div>
</div><div id="footer"><div class="pageFooter">Copyright &copy; Sitename 2005</div><div class="footerEnd"><p></p></div></div></div></div></body></html>
